<?php
$title = "Received";
require_once 'include/header.php';
require_once 'db/conn.php';
?>
<h1>Testing!!</h1>
<?php
if ($_SERVER["REQUEST_METHOD"] == "POST") {
    $email = $_POST["email"];
    $address = $_POST["address"];
    $city = $_POST["city"];
    $province = $_POST["province"];
    $postalcode = $_POST["postalcode"];

    $email = mysqli_real_escape_string($_conn, $email);
    $address = mysqli_real_escape_string($_conn, $address);
    $city = mysqli_real_escape_string($_conn, $city);
    $province = mysqli_real_escape_string($_conn, $province);
    $postalcode = mysqli_real_escape_string($_conn, $postalcode);

    $sql = "INSERT INTO client_info (email, address, city, province, postalcode) VALUES ('$email', '$address', '$city', '$province', '$postalcode')";

    if (mysqli_query($conn, $sql)) {
        echo "Records inserted successfully.";
    } else {
        echo "ERROR: Could not able to execute $sql. " . mysqli_error($conn);
    }
}
?>
<?php
require_once 'include/footer.php';
?>










<?php
$title = "Received";
require_once "db/Connection.php";
require_once './include/header.php';

?>
<?php
if ($_SERVER["REQUEST_METHOD"] == "POST") {
    // Validate inputs
    $errors = [];

    $email = filter_var($_POST['email'] ?? '', FILTER_VALIDATE_EMAIL);
    $address = trim($_POST['address'] ?? '');
    $city = trim($_POST['city'] ?? '');
    $province = trim($_POST['province'] ?? '');
    $postal_code = trim($_POST['postal_code'] ?? '');

    if (!$email) {
        $errors[] = "Invalid email address";
    }
    if (empty($address)) {
        $errors[] = "Address is required";
    }
    if (empty($city)) {
        $errors[] = "City is required";
    }
    if (empty($province)) {
        $errors[] = "Province is required";
    }
    if (empty($postal_code)) {
        $errors[] = "Postal code is required";
    }

    if (empty($errors)) {
        // Use prepared statement to prevent SQL injection
        $sql = "INSERT INTO client_info (email, address, city, province, postal_code) VALUES (?, ?, ?, ?, ?)";
        $stmt = mysqli_prepare($Connection, $sql);

        if ($stmt) {
            mysqli_stmt_bind_param($stmt, "sssss", $email, $address, $city, $province, $postal_code);

            if (mysqli_stmt_execute($stmt)) {
                echo "<div class='alert alert-success'>Record added successfully.</div>";
            } else {
                echo "<div class='alert alert-danger'>Error: Unable to save record.</div>";
            }
            mysqli_stmt_close($stmt);
        } else {
            echo "<div class='alert alert-danger'>Database error.</div>";
        }
    } else {
        foreach ($errors as $error) {
            echo "<div class='alert alert-danger'>$error</div>";
        }
    }
}
?>
<?php
require_once './includes/footer.php';
?>